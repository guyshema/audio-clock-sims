<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Audio Clock Jitter Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: white;
        }
        
        h1 {
            font-size: clamp(1.3rem, 4vw, 2rem);
            margin: 15px 0;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .creator-credit {
            text-align: center;
            font-size: 12px;
            opacity: 0.8;
            margin-top: -10px;
            margin-bottom: 15px;
        }
        
        .creator-credit a {
            color: #00ff88;
            text-decoration: none;
        }
        
        .main-container {
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .clock-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .clocks-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .clock-unit {
            text-align: center;
        }
        
        .clock {
            position: relative;
            width: min(200px, 40vw);
            height: min(200px, 40vw);
            background: radial-gradient(circle, #0a0e27, #000);
            border-radius: 50%;
            box-shadow: 
                0 0 30px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(0,0,0,0.5);
            margin: 0 auto 10px;
        }
        
        .clock-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .good-clock .clock-title {
            color: #00ff88;
        }
        
        .bad-clock .clock-title {
            color: #ff6b6b;
        }
        
        /* Clock marks */
        .tick {
            position: absolute;
            width: 2px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            left: calc(50% - 1px);
            top: 5px;
            transform-origin: center calc(100px - 5px);
        }
        
        .tick.major {
            height: 12px;
            width: 3px;
            background: rgba(255,255,255,0.6);
            left: calc(50% - 1.5px);
        }
        
        /* Sampling hand */
        .sampling-hand {
            position: absolute;
            width: 3px;
            height: 45%;
            background: linear-gradient(to top, transparent, #ffd700);
            top: 5%;
            left: calc(50% - 1.5px);
            transform-origin: center calc(100px - 5px);
            box-shadow: 0 0 10px #ffd700;
            transition: none;
        }
        
        .good-clock .sampling-hand {
            background: linear-gradient(to top, transparent, #00ff88);
            box-shadow: 0 0 10px #00ff88;
        }
        
        .bad-clock .sampling-hand {
            background: linear-gradient(to top, transparent, #ff6b6b);
            box-shadow: 0 0 10px #ff6b6b;
        }
        
        /* Center dot */
        .center-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            z-index: 10;
        }
        
        /* Sample indicator */
        .sample-indicator {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffd700;
            border-radius: 50%;
            top: 10px;
            left: calc(50% - 4px);
            opacity: 0;
            transform-origin: center calc(100px - 10px);
            box-shadow: 0 0 10px currentColor;
        }
        
        .sample-indicator.flash {
            animation: flash 0.3s ease-out;
        }
        
        @keyframes flash {
            0% { opacity: 0; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(1); }
        }
        
        /* Waveform canvas */
        .waveform-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
        }
        
        canvas {
            width: 100%;
            height: 250px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button.active {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
        }
        
        /* Info panels */
        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        
        /* Jitter display */
        .jitter-display {
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        
        .jitter-value {
            font-weight: bold;
            color: #ffd700;
            font-size: 20px;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .clock {
                width: min(150px, 35vw);
                height: min(150px, 35vw);
            }
            
            .sampling-hand {
                transform-origin: center calc(75px - 5px);
            }
            
            .sample-indicator {
                transform-origin: center calc(75px - 10px);
            }
            
            .tick {
                transform-origin: center calc(75px - 5px);
            }
            
            canvas {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <h1>üéõÔ∏è Audio Sampling Jitter Effect</h1>
    <div class="creator-credit">
        Created by Guy Shema Oppenheimer <a href="https://www.instagram.com/oppenmasters" target="_blank">@Oppenmasters</a>
    </div>
    
    <div class="info-panel" style="max-width: 600px; margin: 10px auto 20px; text-align: center;">
        <strong>Explanation:</strong> The hand shows the moment each sample is taken.
        In a perfect clock, samples are taken at exactly equal time intervals. 
        With jitter, each sample may be taken slightly too early or too late. 
        This small timing error means the wrong part of the wave is captured, 
        creating distortion in the sound when it‚Äôs played back.
    </div>
    
    <!-- Top controls (duplicate) -->
    <div class="controls">
        <button id="playBtnTop">‚ñ∂Ô∏è Play</button>
        <button id="speedBtnTop">üéöÔ∏è Speed: Normal</button>
        <button id="jitterBtnTop">üìä Jitter: 10%</button>
        <button id="resetBtnTop">üîÑ Reset</button>
    </div>
    
    <div class="main-container">
        <div class="clock-section">
            <div class="clocks-row">
                <div class="clock-unit good-clock">
                    <div class="clock-title">‚úÖ Precise Clock</div>
                    <div class="clock" id="goodClock">
                        <!-- Clock ticks -->
                        <div class="ticks"></div>
                        <!-- Sampling hand -->
                        <div class="sampling-hand" id="goodHand"></div>
                        <!-- Sample indicators -->
                        <div class="sample-indicator" id="goodSample"></div>
                        <div class="center-dot"></div>
                    </div>
                    <div class="info-panel">
                        Sampling at fixed intervals
                    </div>
                </div>
                
                <div class="clock-unit bad-clock">
                    <div class="clock-title">‚ö†Ô∏è Clock with Jitter</div>
                    <div class="clock" id="badClock">
                        <!-- Clock ticks -->
                        <div class="ticks"></div>
                        <!-- Sampling hand -->
                        <div class="sampling-hand" id="badHand"></div>
                        <!-- Sample indicators -->
                        <div class="sample-indicator" id="badSample"></div>
                        <div class="center-dot"></div>
                    </div>
                    <div class="info-panel">
                        Unstable sampling
                    </div>
                </div>
            </div>
            
            <div class="jitter-display">
                Jitter Level: <span class="jitter-value" id="jitterLevel">10%</span>
            </div>
        </div>
        
        <div class="clock-section">
            <h3 style="text-align: center; margin-bottom: 15px;">üìä Waveform & Samples</h3>
            <div class="waveform-container">
                <canvas id="waveform"></canvas>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4a9eff;"></div>
                    <span>Original Wave</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #00ff88;"></div>
                    <span>Precise Samples</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b6b;"></div>
                    <span>Jittered Samples</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255,255,0,0.5);"></div>
                    <span>Reconstructed (Jitter)</span>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="playBtn">‚ñ∂Ô∏è Play</button>
            <button id="speedBtn">üéöÔ∏è Speed: Normal</button>
            <button id="jitterBtn">üìä Jitter: 10%</button>
            <button id="resetBtn">üîÑ Reset</button>
        </div>
    </div>
    
    <script>
        // Global variables
        let isPlaying = false;
        let animationId = null;
        let time = 0;
        let speed = 1;
        let jitterAmount = 0.1; // 10% jitter
        let sampleRate = 20; // samples per rotation
        let lastSampleTime = { good: 0, bad: 0 };
        
        // Canvas setup
        const canvas = document.getElementById('waveform');
        const ctx = canvas.getContext('2d');
        
        // Samples storage
        let goodSamples = [];
        let badSamples = [];
        const maxSamples = 50;
        
        // Initialize
        function init() {
            setupCanvas();
            addClockTicks();
            drawStaticWaveform();
        }
        
        // Setup canvas dimensions
        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        
        // Add clock tick marks
        function addClockTicks() {
            const clocks = document.querySelectorAll('.ticks');
            clocks.forEach(clock => {
                for (let i = 0; i < 12; i++) {
                    const tick = document.createElement('div');
                    tick.className = i % 3 === 0 ? 'tick major' : 'tick';
                    tick.style.transform = `rotate(${i * 30}deg)`;
                    clock.appendChild(tick);
                }
            });
        }
        
        // Animation loop
        function animate(timestamp) {
            if (!isPlaying) return;
            
            time += 0.016 * speed; // ~60fps
            
            // Calculate angles
            const baseAngle = (time * 60) % 360;
            const jitterOffset = Math.sin(time * 7.3) * jitterAmount * 30 + 
                               Math.sin(time * 13.7) * jitterAmount * 15 +
                               (Math.random() - 0.5) * jitterAmount * 10;
            
            // Update clock hands
            document.getElementById('goodHand').style.transform = `rotate(${baseAngle}deg)`;
            document.getElementById('badHand').style.transform = `rotate(${baseAngle + jitterOffset}deg)`;
            
            // Check for sampling moments
            const sampleInterval = 360 / sampleRate;
            const currentSampleIndex = Math.floor(baseAngle / sampleInterval);
            
            // Good clock sampling
            if (currentSampleIndex !== lastSampleTime.good) {
                lastSampleTime.good = currentSampleIndex;
                takeSample('good', baseAngle);
            }
            
            // Bad clock sampling (with jitter)
            const badAngle = baseAngle + jitterOffset;
            const badSampleIndex = Math.floor(badAngle / sampleInterval);
            if (badSampleIndex !== lastSampleTime.bad) {
                lastSampleTime.bad = badSampleIndex;
                takeSample('bad', badAngle);
            }
            
            // Draw waveform
            drawWaveform();
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Take a sample
        function takeSample(type, angle) {
            // Flash indicator
            const indicator = document.getElementById(type + 'Sample');
            indicator.style.transform = `rotate(${angle}deg)`;
            indicator.classList.remove('flash');
            void indicator.offsetWidth; // Force reflow
            indicator.classList.add('flash');
            
            // Calculate sample value from sine wave
            const normalizedAngle = (angle % 360) / 360;
            const sampleTime = normalizedAngle * Math.PI * 2;
            const sampleValue = Math.sin(sampleTime * 2); // 2 cycles per rotation
            
            // Store sample
            const samples = type === 'good' ? goodSamples : badSamples;
            samples.push({
                time: normalizedAngle,
                value: sampleValue,
                angle: angle
            });
            
            // Limit samples
            if (samples.length > maxSamples) {
                samples.shift();
            }
        }
        
        // Draw waveform
        function drawWaveform() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            // Clear canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            const padding = 20;
            const graphWidth = width - padding * 2;
            const graphHeight = height - padding * 2;
            const centerY = height / 2;
            
            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, centerY);
            ctx.lineTo(width - padding, centerY);
            ctx.stroke();
            
            // Draw original sine wave
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < graphWidth; x++) {
                const t = (x / graphWidth) * Math.PI * 4; // 2 full cycles
                const y = centerY - Math.sin(t) * graphHeight * 0.4; // Fixed: minus instead of plus
                if (x === 0) {
                    ctx.moveTo(padding + x, y);
                } else {
                    ctx.lineTo(padding + x, y);
                }
            }
            ctx.stroke();
            
            // Draw good samples
            ctx.fillStyle = '#00ff88';
            goodSamples.forEach(sample => {
                const x = padding + sample.time * graphWidth;
                const y = centerY - sample.value * graphHeight * 0.4;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw bad samples
            ctx.fillStyle = '#ff6b6b';
            badSamples.forEach(sample => {
                const x = padding + sample.time * graphWidth;
                const y = centerY - sample.value * graphHeight * 0.4;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw reconstructed wave from bad samples (if enough samples)
            if (badSamples.length > 3) {
                ctx.strokeStyle = 'rgba(255, 255, 0, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                
                // Sort samples by time
                const sortedBadSamples = [...badSamples].sort((a, b) => a.time - b.time);
                
                sortedBadSamples.forEach((sample, i) => {
                    const x = padding + sample.time * graphWidth;
                    const y = centerY - sample.value * graphHeight * 0.4;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // Draw static waveform (when not playing)
        function drawStaticWaveform() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = 20;
            const graphWidth = width - padding * 2;
            const centerY = height / 2;
            
            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, centerY);
            ctx.lineTo(width - padding, centerY);
            ctx.stroke();
            
            // Draw sine wave
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < graphWidth; x++) {
                const t = (x / graphWidth) * Math.PI * 4;
                const y = centerY - Math.sin(t) * height * 0.35; // Fixed: minus instead of plus
                if (x === 0) {
                    ctx.moveTo(padding + x, y);
                } else {
                    ctx.lineTo(padding + x, y);
                }
            }
            ctx.stroke();
        }
        
        // Event listeners
        document.getElementById('playBtn').addEventListener('click', playToggle);
        document.getElementById('playBtnTop').addEventListener('click', playToggle);
        
        function playToggle() {
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
            document.getElementById('playBtnTop').textContent = isPlaying ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
            document.getElementById('playBtn').classList.toggle('active');
            document.getElementById('playBtnTop').classList.toggle('active');
            
            if (isPlaying) {
                animate();
            } else {
                cancelAnimationFrame(animationId);
            }
        }
        
        document.getElementById('speedBtn').addEventListener('click', speedToggle);
        document.getElementById('speedBtnTop').addEventListener('click', speedToggle);
        
        function speedToggle() {
            const speeds = [0.5, 1, 2];
            const labels = ['Slow', 'Normal', 'Fast'];
            let currentIndex = speeds.indexOf(speed);
            currentIndex = (currentIndex + 1) % speeds.length;
            speed = speeds[currentIndex];
            document.getElementById('speedBtn').textContent = `üéöÔ∏è Speed: ${labels[currentIndex]}`;
            document.getElementById('speedBtnTop').textContent = `üéöÔ∏è Speed: ${labels[currentIndex]}`;
        }
        
        document.getElementById('jitterBtn').addEventListener('click', jitterToggle);
        document.getElementById('jitterBtnTop').addEventListener('click', jitterToggle);
        
        function jitterToggle() {
            const jitterLevels = [0, 0.1, 0.25, 0.5];
            const labels = ['0%', '10%', '25%', '50%'];
            let currentIndex = jitterLevels.indexOf(jitterAmount);
            currentIndex = (currentIndex + 1) % jitterLevels.length;
            jitterAmount = jitterLevels[currentIndex];
            document.getElementById('jitterBtn').textContent = `üìä Jitter: ${labels[currentIndex]}`;
            document.getElementById('jitterBtnTop').textContent = `üìä Jitter: ${labels[currentIndex]}`;
            document.getElementById('jitterLevel').textContent = labels[currentIndex];
        }
        
        document.getElementById('resetBtn').addEventListener('click', resetSimulation);
        document.getElementById('resetBtnTop').addEventListener('click', resetSimulation);
        
        function resetSimulation() {
            time = 0;
            goodSamples = [];
            badSamples = [];
            lastSampleTime = { good: 0, bad: 0 };
            
            document.getElementById('goodHand').style.transform = 'rotate(0deg)';
            document.getElementById('badHand').style.transform = 'rotate(0deg)';
            
            if (!isPlaying) {
                drawStaticWaveform();
            }
        }
        
        // Window resize handler
        window.addEventListener('resize', () => {
            setupCanvas();
            if (!isPlaying) {
                drawStaticWaveform();
            }
        });
        
        // Initialize on load
        init();
    </script>
</body>
</html>
